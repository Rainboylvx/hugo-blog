---
title: "lldbè°ƒè¯•ç¨‹åºé‡å®šå‘è¾“å…¥"
date: 2025-10-12
draft: false
toc: true
tags: [""]
categories: [""]
---



å¥½çš„ï¼Œåœ¨ Mac M1 èŠ¯ç‰‡ä¸Šä½¿ç”¨å‘½ä»¤è¡Œ `lldb` è°ƒè¯•ï¼Œå¹¶ä¸ºç¨‹åºæŒ‡å®šè¾“å…¥æ–‡ä»¶ï¼Œè¿™éœ€è¦ä¸¤æ­¥å…³é”®æ“ä½œï¼š

1.  **ä¸ºä½ çš„å¯æ‰§è¡Œæ–‡ä»¶è¿›è¡Œä»£ç ç­¾å** (è¿™æ˜¯ M1/M2/M3 èŠ¯ç‰‡ Mac çš„ç‰¹æ®Šè¦æ±‚)ã€‚
2.  **åœ¨ lldb å†…éƒ¨ä½¿ç”¨æ­£ç¡®çš„å‘½ä»¤æ¥é‡å®šå‘è¾“å…¥**ã€‚

ä½ ä¸èƒ½åƒåœ¨ shell é‡Œé‚£æ ·ç›´æ¥ä½¿ç”¨ `<` ç¬¦å·ï¼Œå³ `lldb 1.out < in.txt` æ˜¯**é”™è¯¯**çš„ï¼Œå› ä¸ºè¿™ä¼šæŠŠ `in.txt` çš„å†…å®¹è¾“å…¥ç»™ `lldb` ç¨‹åºæœ¬èº«ï¼Œè€Œä¸æ˜¯ä½ è¦è°ƒè¯•çš„ `1.out`ã€‚

ä¸‹é¢æ˜¯è¯¦ç»†çš„æ­¥éª¤å’Œè§£é‡Šã€‚

-----

### å‡†å¤‡å·¥ä½œï¼šä¸€ä¸ªç¤ºä¾‹ç¨‹åº

æˆ‘ä»¬å…ˆåˆ›å»ºä¸€ä¸ªç®€å•çš„ C++ ç¨‹åºå’Œè¾“å…¥æ–‡ä»¶æ¥è¿›è¡Œæ¼”ç¤ºã€‚

**1. åˆ›å»ºæºä»£ç  `test.cpp`**
è¿™ä¸ªç¨‹åºä¼šè¯»å–ä¸€ä¸ªæ•´æ•°å’Œä¸€ä¸ªå­—ç¬¦ä¸²ã€‚

```cpp
#include <iostream>
#include <string>

int main() {
    int id;
    std::string name;

    std::cout << "å‡†å¤‡ä»æ ‡å‡†è¾“å…¥è¯»å–æ•°æ®..." << std::endl;

    // ä»æ ‡å‡†è¾“å…¥(stdin)è¯»å–æ•°æ®
    std::cin >> id;
    std::cin >> name;

    std::cout << "è¯»å–åˆ°çš„ ID: " << id << std::endl;
    std::cout << "è¯»å–åˆ°çš„ Name: " << name << std::endl;

    return 0;
}
```

**2. åˆ›å»ºè¾“å…¥æ–‡ä»¶ `in.txt`**
æ–‡ä»¶çš„å†…å®¹è¦å’Œç¨‹åºè¯»å–çš„æ ¼å¼å¯¹åº”ã€‚

```txt
101
Gemini
```

**3. ç¼–è¯‘ç¨‹åº**
ä½¿ç”¨ `g++` ç¼–è¯‘ï¼Œå¹¶ä¸”**ä¸€å®šè¦åŠ ä¸Š `-g` å‚æ•°**ï¼Œè¿™æ ·æ‰ä¼šåŒ…å«è°ƒè¯•ä¿¡æ¯ï¼Œå¦åˆ™ lldb çœ‹ä¸åˆ°æºä»£ç ã€‚

```bash
g++ -g test.cpp -o 1.out
```

ç°åœ¨ä½ çš„æ–‡ä»¶å¤¹é‡Œåº”è¯¥æœ‰ `1.out` å’Œ `in.txt` äº†ã€‚

-----

### âš ï¸ æ­¥éª¤ä¸€ï¼šä»£ç ç­¾å (M1/M2/M3 Mac å¿…éœ€)

åœ¨ Apple Silicon èŠ¯ç‰‡çš„ Mac ä¸Šï¼Œå‡ºäºå®‰å…¨åŸå› ï¼Œè°ƒè¯•å™¨ lldb æ— æ³•é™„åŠ åˆ°æ²¡æœ‰ç»è¿‡ç­¾åçš„å¯æ‰§è¡Œæ–‡ä»¶ä¸Šã€‚ä½ éœ€è¦ä¸º `1.out` åˆ›å»ºä¸€ä¸ªä¸´æ—¶çš„â€œå³å¸­ç­¾åâ€(ad-hoc signature) å¹¶èµ‹äºˆå®ƒè°ƒè¯•æƒé™ã€‚

**1. åˆ›å»ºä¸€ä¸ªæƒé™æè¿°æ–‡ä»¶ `entitlements.xml`**
åœ¨ä¸ `1.out` ç›¸åŒçš„ç›®å½•ä¸‹ï¼Œåˆ›å»ºä¸€ä¸ªåä¸º `entitlements.xml` çš„æ–‡ä»¶ï¼Œå†…å®¹å¦‚ä¸‹ï¼š

```xml
<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE plist PUBLIC "-//Apple//DTD PLIST 1.0//EN" "http://www.apple.com/DTDs/PropertyList-1.0.dtd">
<plist version="1.0">
<dict>
    <key>com.apple.security.get-task-allow</key>
    <true/>
</dict>
</plist>
```

è¿™ä¸ªæ–‡ä»¶é‡Œçš„ `com.apple.security.get-task-allow` é”®è®¾ç½®ä¸º `true`ï¼Œå°±æ˜¯å‘Šè¯‰ç³»ç»Ÿâ€œå…è®¸å…¶ä»–è¿›ç¨‹ï¼ˆæ¯”å¦‚è°ƒè¯•å™¨ï¼‰é™„åŠ åˆ°è¿™ä¸ªç¨‹åºä¸Šâ€ã€‚

**2. ä½¿ç”¨ `codesign` å‘½ä»¤è¿›è¡Œç­¾å**
æ‰“å¼€ç»ˆç«¯ï¼Œè¿è¡Œä»¥ä¸‹å‘½ä»¤ï¼š

```bash
codesign -s - --entitlements entitlements.xml --force ./1.out
```

  * `-s -`ï¼šè¡¨ç¤ºä½¿ç”¨ä¸€ä¸ªä¸´æ—¶çš„å³å¸­ç­¾åï¼Œä¸éœ€è¦å¼€å‘è€…è¯ä¹¦ã€‚
  * `--entitlements entitlements.xml`ï¼šå°†ä¸Šé¢åˆ›å»ºçš„æƒé™æ–‡ä»¶åº”ç”¨åˆ°ç¨‹åºä¸Šã€‚
  * `--force`ï¼šå¼ºåˆ¶è¦†ç›–ç°æœ‰çš„ç­¾åï¼ˆå¦‚æœæœ‰çš„è¯ï¼‰ã€‚
  * `./1.out`ï¼šä½ è¦ç­¾åçš„ç›®æ ‡æ–‡ä»¶ã€‚

æ‰§è¡ŒæˆåŠŸåï¼Œ`1.out` å°±å…·å¤‡äº†è¢«è°ƒè¯•çš„èµ„æ ¼ã€‚**æ¯æ¬¡é‡æ–°ç¼–è¯‘åï¼Œéƒ½éœ€è¦é‡æ–°è¿›è¡Œç­¾å**ã€‚

-----

### ğŸš€ æ­¥éª¤äºŒï¼šä½¿ç”¨ LLDB è¿›è¡Œè°ƒè¯•å’Œè¾“å…¥é‡å®šå‘

ç°åœ¨å¯ä»¥å¼€å§‹çœŸæ­£çš„è°ƒè¯•äº†ã€‚

**1. å¯åŠ¨ LLDB**
åœ¨ç»ˆç«¯ä¸­ï¼Œç”¨ lldb åŠ è½½ä½ çš„ç¨‹åºï¼š

```bash
lldb ./1.out
```

ä½ ä¼šçœ‹åˆ° lldb çš„æç¤ºç¬¦ `(lldb)`ã€‚

```
(lldb) target create "./1.out"
Current executable set to '/path/to/your/project/1.out' (arm64).
(lldb)
```

**2. è®¾ç½®æ–­ç‚¹**
åœ¨ç¨‹åºå¼€å§‹è¿è¡Œå‰ï¼Œæˆ‘ä»¬å…ˆåœ¨ `main` å‡½æ•°è®¾ç½®ä¸€ä¸ªæ–­ç‚¹ã€‚

```bash
(lldb) b main
```

æˆ–è€…ï¼Œå¦‚æœä½ æƒ³åœ¨è¯»å–æ•°æ®çš„é‚£ä¸€è¡Œè®¾ç½®æ–­ç‚¹ï¼š

```bash
(lldb) b test.cpp:11
```

**3. è¿è¡Œç¨‹åºå¹¶é‡å®šå‘è¾“å…¥ (æ ¸å¿ƒæ­¥éª¤)**
ä½¿ç”¨ `process launch` å‘½ä»¤ï¼ˆå¯ä»¥ç®€å†™ä¸º `run`ï¼‰æ¥å¯åŠ¨ç¨‹åºï¼Œå¹¶ä½¿ç”¨ `--stdin` (æˆ–ç®€å†™ `-i`) æ ‡å¿—æ¥æŒ‡å®šè¾“å…¥æ–‡ä»¶ã€‚

```bash
(lldb) process launch --stdin in.txt
```

æˆ–è€…ä½¿ç”¨ç®€å†™å½¢å¼ï¼š

```bash
(lldb) run -i in.txt
```

**4. å¼€å§‹è°ƒè¯•**
ç¨‹åºä¼šå¼€å§‹è¿è¡Œï¼Œå¹¶åœ¨ä½ è®¾ç½®çš„æ–­ç‚¹å¤„åœä¸‹æ¥ã€‚

```
Process 12345 launched: '/path/to/your/project/1.out' (arm64)
...
Process 12345 stopped
* thread #1, queue = 'com.apple.main-thread', stop reason = breakpoint 1.1
    frame #0: 0x0000000100003e8c 1.out`main at test.cpp:7
   4   	
   5   	int main() {
   6   	    int id;
-> 7   	    std::string name;
   8   	
   9   	    std::cout << "å‡†å¤‡ä»æ ‡å‡†è¾“å…¥è¯»å–æ•°æ®..." << std::endl;
   10  	
   11  	    // ä»æ ‡å‡†è¾“å…¥(stdin)è¯»å–æ•°æ®
Target 0: (1.out) stopped.
(lldb)
```

ç°åœ¨ä½ å°±å¯ä»¥ä½¿ç”¨ lldb çš„å„ç§å‘½ä»¤è¿›è¡Œè°ƒè¯•äº†ï¼š

  * `n` (next): æ‰§è¡Œä¸‹ä¸€è¡Œä»£ç ã€‚
  * `c` (continue): ç»§ç»­æ‰§è¡Œç›´åˆ°ä¸‹ä¸€ä¸ªæ–­ç‚¹æˆ–ç¨‹åºç»“æŸã€‚
  * `p <variable>` (print): æ‰“å°å˜é‡çš„å€¼ã€‚

å½“ä½ æ‰§è¡Œè¿‡ `std::cin >> id;` ä¹‹åï¼Œå¯ä»¥æ‰“å° `id` çš„å€¼æ¥éªŒè¯å®ƒæ˜¯å¦æˆåŠŸä» `in.txt` ä¸­è¯»å–äº†æ•°æ®ã€‚

```bash
(lldb) n
... (æ‰§è¡Œå‡ æ­¥ç›´åˆ° cin ä¹‹å)
(lldb) p id
(int) $0 = 101
(lldb) p name
(std::string) $1 = "Gemini"
```

ä½ ä¼šçœ‹åˆ°å˜é‡çš„å€¼å’Œ `in.txt` æ–‡ä»¶ä¸­çš„å†…å®¹å®Œå…¨ä¸€è‡´ã€‚

### æ€»ç»“

å®Œæ•´çš„æµç¨‹æ˜¯ï¼š

1.  `g++ -g your_code.cpp -o 1.out`  (ç¼–è¯‘)
2.  `codesign -s - --entitlements entitlements.xml --force ./1.out` (ç­¾åï¼Œä»… M1/2/3 Mac é¦–æ¬¡æˆ–é‡æ–°ç¼–è¯‘åéœ€è¦)
3.  `lldb ./1.out` (å¯åŠ¨ lldb)
4.  `(lldb) b main` (è®¾ç½®æ–­ç‚¹)
5.  `(lldb) run -i in.txt` (è¿è¡Œå¹¶é‡å®šå‘è¾“å…¥)
6.  å¼€å§‹ä½ çš„è°ƒè¯•ä¹‹æ—…ï¼