---
title: "前置知识装饰器-实现一个GET请求"
date: 2025-11-09
draft: false
toc: true
tags: ["前端", "javascript", "开发语言"]
categories: ["Nestjs"]
---

本文介绍了如何使用装饰器工厂结合`axios`实现HTTP请求的拦截和错误处理，展示了如何定义控制器和应用`@Get`装饰器到其中的方法，以优雅地管理接口调用并处理响应状态。

### 1. 安装依赖

首先，我们需要安装`axios`来处理HTTP请求。

```bash
npm install axios -S
```

### 2. 定义控制器

接下来，我们定义一个简单的控制器类，后续将会在其中的方法上使用我们的装饰器。

```typescript
class Controller {
    constructor() {
 
    }
    getList () {
 
    }
}
```

### 3. 定义装饰器

为了能够传递URL参数给装饰器，我们需要使用装饰器工厂。装饰器工厂就是一个返回装饰器函数的函数。

这个`@Get`装饰器会拦截被装饰的方法，使用`axios`发送一个GET请求，并将请求结果和状态码作为参数传递给原方法。

- **装饰器工厂**: `Get(url: string)`接收一个`url`字符串，并返回一个方法装饰器。
- **方法装饰器**: 返回的函数接收三个参数：`target`（类的原型），`key`（方法名），和`descriptor`（属性描述符）。
- **descriptor.value**: 我们通过`descriptor.value`可以获取到原始的方法实现。我们保存它，然后在`axios`请求成功或失败后，调用原始方法并传入相应的数据。

```typescript
import axios from 'axios';

const Get = (url: string): MethodDecorator => {
    return (target, key, descriptor: PropertyDescriptor) => {
        const fnc = descriptor.value; // 获取原始方法
        axios.get(url).then(res => {
            // 请求成功，调用原始方法并传入结果
            fnc(res, {
                status: 200,
            })
        }).catch(e => {
            // 请求失败，调用原始方法并传入错误信息
            fnc(e, {
                status: 500,
            })
        })
    }
}
```

### 4. 完整代码示例

下面是结合了控制器和`@Get`装饰器的完整代码。`getList`方法被`@Get`装饰后，会自动发起网络请求，并将结果打印出来。

```typescript
import axios from 'axios';

// Get 装饰器工厂
const Get = (url: string): MethodDecorator => {
    return (target, key, descriptor: PropertyDescriptor) => {
        const fnc = descriptor.value;
        axios.get(url).then(res => {
            fnc(res, {
                status: 200,
            })
        }).catch(e => {
            fnc(e, {
                status: 500,
            })
        })
    }
}
 
// 定义控制器
class Controller {
    constructor() {
 
    }

    @Get('https://api.apiopen.top/api/getHaoKanVideo?page=0&size=10')
    getList (res: any, status: any) {
        if (status.status === 200) {
            console.log(res.data.result.list, status);
        } else {
            console.error('Request Failed:', res);
        }
    }
}

// 实例化控制器以触发装饰器逻辑
new Controller();
```
